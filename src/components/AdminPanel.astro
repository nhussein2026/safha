---
// at top of your component
const isDev = import.meta.env.DEV;
const now = new Date();
---

{
  isDev && (
    <div class="p-8 bg-snow-white dark:bg-dark-navy rounded-lg shadow-md my-8 border border-morning-fog dark:border-deep-ocean transition-colors duration-300">
      <h2 class="text-2xl font-bold mb-6 pb-4 border-b border-morning-fog dark:border-deep-ocean text-sky-blue dark:text-royal-periwinkle">
        إنشاء منشور جديد
      </h2>

      <form id="createPostForm" class="space-y-8">
        {/* Slug & Title & Description */}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {/* title */}
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              العنوان
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="text"
              name="title"
              required
            />
          </div>
          {/* Optional meta */}
          <div>
            <label class="block text-mountain-mist dark:text-morning-fog/80 font-medium mb-2">
              المؤلف (اختياري)
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean dark:text-morning-fog/70 rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="text"
              name="author"
              placeholder="اسم المؤلف"
            />
          </div>
          {/* slug */}
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              الرابط المختصر (Slug)
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle dark:text-morning-fog/70 bg-transparent"
              type="text"
              name="slug"
              placeholder="my-blog-post"
              pattern="^[a-z0-9-]+$"
              required
            />
            <p class="mt-2 text-sm text-mountain-mist dark:text-morning-fog/70">
              أحرف صغيرة، أرقام، وشرطات فقط
            </p>
          </div>
        </div>
        {/* Date Inputs */}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          {/** Year */}
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              السنة
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="number"
              name="year"
              value={now.getFullYear()}
              required
            />
          </div>
          {/** Month */}
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              الشهر
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="number"
              name="month"
              min="1"
              max="12"
              value={now.getMonth() + 1}
              required
            />
          </div>
          {/** Day */}
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              اليوم
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="number"
              name="day"
              min="1"
              max="31"
              value={now.getDate()}
              required
            />
          </div>
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              التاريخ الهجري (اختياري)
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="text"
              name="arabicDate"
              placeholder="١ رمضان ١٤٤٥"
            />
          </div>
        </div>

        <div>
          <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
            الوصف المختصر
          </label>
          <textarea
            class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent resize-y"
            name="description"
            rows={2}
            required
          />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              الوسوم (فصل بفواصل)
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="text"
              name="tags"
              placeholder="تقنية, برمجة"
            />
          </div>
          <div>
            <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
              التصنيفات (فصل بفواصل)
            </label>
            <input
              class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent"
              type="text"
              name="categories"
              placeholder="مقالات, دروس"
            />
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-center">
            <input
              class="form-checkbox h-5 w-5 text-royal-periwinkle dark:text-sky-blue border-morning-fog rounded focus:ring-sky-blue dark:focus:ring-royal-periwinkle"
              type="checkbox"
              name="draft"
              id="draft"
              value="true"
            />
            <label
              for="draft"
              class="ms-3 text-deep-ocean dark:text-morning-fog"
            >
              وضع كمُسودة
            </label>
          </div>
        </div>

        <div>
          <label class="block text-deep-ocean dark:text-morning-fog font-medium mb-2">
            المحتوى
          </label>
          <textarea
            class="w-full px-4 py-2 border border-morning-fog dark:border-deep-ocean rounded-lg focus:ring-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle bg-transparent resize-y"
            name="content"
            rows={8}
            required
          />
        </div>

        <button
          type="submit"
          class="w-full py-3 px-6 bg-royal-periwinkle dark:bg-sky-blue text-white rounded-lg hover:bg-royal-periwinkle/90 dark:hover:bg-sky-blue/90 transition-colors duration-200 font-medium focus:ring-2 focus:ring-offset-2 focus:ring-sky-blue dark:focus:ring-royal-periwinkle"
        >
          إنشاء المنشور
        </button>
      </form>
    </div>
  )
}

<script>
  document
    .getElementById("createPostForm")
    ?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      // slug live validity
      const slugEl = form.slug;
      if (!new RegExp(slugEl.pattern).test(slugEl.value)) {
        slugEl.setCustomValidity("الرابط المختصر غير صالح");
        slugEl.reportValidity();
        return;
      }

      // Build payload
      const fd = new FormData(form);
      const payload = Object.fromEntries(fd.entries());
      // Note: draft checkbox only included if checked; ensure default false:
      if (!payload.draft) payload.draft = "false";

      try {
        const res = await fetch("/api/create-post", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        const json = await res.json();
        if (json.success) {
          alert(`تم الإنشاء: ${json.filePath}`);
          form.reset();
        } else {
          throw new Error(json.error);
        }
      } catch (err) {
        alert(`خطأ: ${err.message}`);
      }
    });
</script>
